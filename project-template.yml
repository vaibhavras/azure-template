#pool:
#
#  name: Azure Pipelines
#
#  demands: java



#Your build pipeline references an undefined variable named �Parameters.wrapperScript�. Create or edit the build pipeline for this YAML file, define the variable on the Variables tab. See https://go.microsoft.com/fwlink/?linkid=865972

#Your build pipeline references an undefined variable named �Parameters.tasks�. Create or edit the build pipeline for this YAML file, define the variable on the Variables tab. See https://go.microsoft.com/fwlink/?linkid=865972

#  8a3e7ca7ee72dd267914a681293f59ea7d8448f9

steps:

  - task: SonarSource.sonarqube.15B84CA1-B62F-4A2A-A403-89B77A063157.SonarQubePrepare@4
    displayName: 'Prepare analysis on SonarQube'
    inputs:
      SonarQube: 'GMT-Sonar'
      scannerMode: Other
      extraProperties: |
        # Additional properties that will be passed to the scanner,
        # Put one key=value per line, example:
        # sonar.exclusions=**/*.bin
        sonar.projectKey= $(sonar.projectKey)
        sonar.projectName=$(sonar.projectName)
        sonar.projectVersion=1.0
        sonar.sourceEncoding=UTF-8
        sonar.projectDescription=Generic azure template.
        sonar.junit.reportPaths = ./build/test-results/test/TEST-*.xml
        sonar.tests=./src/test/java
        sonar.sources=./src/main/java
        sonar.java.binaries=./build/classes
        sonar.jacoco.reportPaths=./build/jacoco/test.exec
        sonar.java.coveragePlugin=jacoco


  - task: Gradle@2
    displayName: 'gradlew build'
    inputs:
      gradleWrapperFile: 'gradlew'
      tasks: 'build'
      jdkVersionOption: 1.11
      sonarQubeRunAnalysis: true

  - task: SonarSource.sonarqube.291ed61f-1ee4-45d3-b1b0-bf822d9095ef.SonarQubePublish@4
    displayName: 'Publish Quality Gate Result'

  - task: CopyFiles@2
    displayName: 'Copy Files to: $(build.artifactstagingdirectory)'
    inputs:
      SourceFolder: '$(system.defaultworkingdirectory)'
      Contents: '**/*.jar'
      TargetFolder: '$(build.artifactstagingdirectory)'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'
    inputs:
      PathtoPublish: '$(build.artifactstagingdirectory)'

